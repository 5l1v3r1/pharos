//
// Directions to build and run tests using a fully-built Ghidra source (not INSTALL) tree
//
// % export GHIDRA_SRC=<Absolute path to root of Ghidra Source repo>
//
// (GHIDRA_INSTALL_DIR should also be set per the "DO NOT MODIFY" Section below)
//
// % cd $GHIDRA_SRC/Ghidra/Extensions
// % git clone https://code.cc.cert.org/Malicious-Code-Team/OOAnalyzerPlugin
// % mkdir $GHIDRA_SRC/Ghidra/Test/TestResources/data
// % cp OOAnalyzerPlugin/data/oo.* ../../Ghidra/Test/TestResources/data
// % ls ../../Ghidra/Test/TestResources/data
// oo.exe		oo.exe.gzf	oo.json
// % cd OOAnalyzerPlugin
// % mv build.gradle build.gradle.saved
// % cp build-test.gradle build.gradle
// % gradle build
//
//
// See OOAnalyzerPlugin/src/test/resources/SampleTestRun.txt
// to compare results.
// *** IGNORE for now ***
// % gradle -b build-test.gradle build
// (gradle -a -b build-test.gradle test also works if dependencies already built)
// ***

// Builds a Ghidra Extension for a given Ghidra installation.
//
// An absolute path to the Ghidra installation directory must be supplied either by setting the 
// GHIDRA_INSTALL_DIR environment variable or Gradle project property:
//
//     > export GHIDRA_INSTALL_DIR=<Absolute path to Ghidra> 
//     > gradle
//
//         or
//
//     > gradle -PGHIDRA_INSTALL_DIR=<Absolute path to Ghidra>
//
// Gradle should be invoked from the directory of the project to build.  Please see the
// application.gradle.version property in <GHIDRA_INSTALL_DIR>/Ghidra/application.properties
// for the correction version of Gradle to use for the Ghidra installation you specify.

//----------------------START "DO NOT MODIFY" SECTION------------------------------
def ghidraInstallDir

if (System.env.GHIDRA_INSTALL_DIR) {
    ghidraInstallDir = System.env.GHIDRA_INSTALL_DIR
}
else if (project.hasProperty("GHIDRA_INSTALL_DIR")) {
    ghidraInstallDir = project.getProperty("GHIDRA_INSTALL_DIR")
}

if (ghidraInstallDir) {
    apply from: new File(ghidraInstallDir).getCanonicalPath() + "/support/buildExtension.gradle"
}
else {
    throw new GradleException("GHIDRA_INSTALL_DIR is not defined!")
}
//----------------------END "DO NOT MODIFY" SECTION-------------------------------

/*********************************************************************************
 *  load properties from Ghidra/application.properties file
 *********************************************************************************/
// stolen from ghidra/build.gradle
//apply from: "/home/jsh/src/ghidra/build.gradle"
//apply from: "/home/jsh/src/ghidra/gradle/support/loadApplicationProperties.gradle"


// Apply GHIDRA_SRC logic here

apply from: "$rootProject.projectDir/gradle/externalGhidraExtension.gradle"
apply from: "$rootProject.projectDir/gradle/javaProject.gradle"
apply from: "$rootProject.projectDir/gradle/javaTestProject.gradle"
//apply from: "/home/jsh/src/ghidra/gradle/helpProject.gradle"

apply plugin: 'eclipse'
eclipse.project.name = 'OOAnalyzerPlugin Test'




/*
        Provide test dependencies here until we figure out how to separate.
*/  
dependencies {
        testCompile "junit:junit:4.12"
	testCompile 'org.junit.jupiter:junit-jupiter:5.4.2'
	testImplementation 'org.junit.jupiter:junit-jupiter:5.4.2'
}

dependencies {
	       compile project(':Base')
}
